<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title | default(value="Dashboard") }} — Velocty Admin</title>
    <link rel="stylesheet" href="/static/css/admin.css">
    <link rel="icon" type="image/png" href="/static/images/favicon.png">
</head>
<body data-theme="{{ settings.admin_theme | default(value='dark') }}">
    <div class="admin-wrapper">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-logo">
                {% if settings.admin_theme | default(value='dark') == "light" %}
                <img src="/static/images/logo-v-light.png" alt="V" class="sidebar-icon">
                <img src="/static/images/logo-transparent-light.png" alt="Velocty" class="sidebar-logo-full">
                {% else %}
                <img src="/static/images/logo-v.png" alt="V" class="sidebar-icon">
                <img src="/static/images/logo-transparent.png" alt="Velocty" class="sidebar-logo-full">
                {% endif %}
            </div>
            <nav class="sidebar-nav">
                <a href="/{{ admin_slug }}" class="nav-item {% if page_title == 'Dashboard' %}active{% endif %}" title="Dashboard">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                    <span class="nav-label">Dashboard</span>
                </a>
                {% if settings.journal_enabled != "false" %}
                <a href="/{{ admin_slug }}/posts" class="nav-item {% if page_title == 'Journal' or page_title == 'New Post' or page_title == 'Edit Post' %}active{% endif %}" title="Journal">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                    <span class="nav-label">Journal</span>
                </a>
                {% endif %}
                {% if settings.portfolio_enabled == "true" %}
                <a href="/{{ admin_slug }}/portfolio" class="nav-item {% if page_title == 'Portfolio' or page_title == 'New Portfolio Item' or page_title == 'Edit Portfolio Item' %}active{% endif %}" title="Portfolio">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                    <span class="nav-label">Portfolio</span>
                </a>
                {% endif %}
                <a href="/{{ admin_slug }}/comments" class="nav-item {% if page_title == 'Comments' %}active{% endif %}" title="Comments">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    <span class="nav-label">Comments</span>
                </a>
                <a href="/{{ admin_slug }}/categories" class="nav-item {% if page_title == 'Categories' %}active{% endif %}" title="Categories">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
                    <span class="nav-label">Categories</span>
                </a>
                <a href="/{{ admin_slug }}/tags" class="nav-item {% if page_title == 'Tags' %}active{% endif %}" title="Tags">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg>
                    <span class="nav-label">Tags</span>
                </a>
                <a href="/{{ admin_slug }}/designer" class="nav-item {% if page_title == 'Designer' or page_title == 'Designs' %}active{% endif %}" title="Designer">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="13.5" cy="6.5" r="2.5"/><path d="M17.08 8.94a1.5 1.5 0 0 1 0 2.12l-7.07 7.07a1.5 1.5 0 0 1-2.12 0l-4.24-4.24a1.5 1.5 0 0 1 0-2.12l7.07-7.07a1.5 1.5 0 0 1 2.12 0z"/></svg>
                    <span class="nav-label">Designer</span>
                </a>
                <a href="/{{ admin_slug }}/import" class="nav-item {% if page_title == 'Import' %}active{% endif %}" title="Import">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    <span class="nav-label">Import</span>
                </a>
                <a href="/{{ admin_slug }}/health" class="nav-item {% if page_title == 'Health' %}active{% endif %}" title="Health">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                    <span class="nav-label">Health</span>
                </a>
                <a href="/{{ admin_slug }}/settings/general" class="nav-item {% if page_title is containing('Settings') %}active{% endif %}" title="Settings">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                    <span class="nav-label">Settings</span>
                </a>
            </nav>
            <div class="sidebar-bottom">
                <div class="sidebar-user-row">
                    <a href="/{{ admin_slug }}/settings/users" title="{{ settings.admin_display_name | default(value='Admin') }}" style="text-decoration:none">
                        <span class="user-avatar">{{ settings.admin_display_name | default(value='A') | truncate(length=1, end='') | upper }}</span>
                    </a>
                    <a href="/{{ admin_slug }}/settings/users" class="nav-label" style="text-decoration:none;color:var(--text-tertiary)">{{ settings.admin_display_name | default(value='Admin') }}</a>
                    <button type="button" class="theme-toggle" id="theme-toggle" title="Toggle theme">
                        {% if settings.admin_theme | default(value='dark') == "light" %}
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                        {% else %}
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
                        {% endif %}
                    </button>
                </div>
                <a href="/{{ admin_slug }}/logout" class="nav-item" title="Logout">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                    <span class="nav-label">Logout</span>
                </a>
            </div>
        </aside>
        <div class="main-area">
            <header class="top-bar">
                <h2 class="page-title">{{ page_title | default(value="Dashboard") }}</h2>
                <div class="top-bar-right"></div>
            </header>
            <main class="content-area">
                {% block content %}{% endblock content %}
            </main>
        </div>
    </div>
    {% block scripts %}{% endblock scripts %}
    <script>
    (function(){
        var isMac = /Mac|iPhone|iPad/.test(navigator.platform || navigator.userAgent);
        document.querySelectorAll('.kbd-mod').forEach(function(el){ el.textContent = isMac ? '⌘' : 'Ctrl'; });
        document.addEventListener('keydown', function(e){
            var mod = isMac ? e.metaKey : e.ctrlKey;
            if (!mod) return;
            if (e.key === 's' || e.key === 'S') {
                e.preventDefault();
                if (typeof tinymce !== 'undefined') tinymce.triggerSave();
                var form = document.querySelector('form');
                if (form) { if (location.hash) form.action = form.action.split('#')[0] + location.hash; form.submit(); }
            }
            if (e.key === 'p' || e.key === 'P') {
                e.preventDefault();
                window.location.href = '/{{ admin_slug }}/posts/new';
            }
            if (e.key === 'i' || e.key === 'I') {
                e.preventDefault();
                window.location.href = '/{{ admin_slug }}/portfolio/new';
            }
        });
    })();
    // Preserve sub-tab hash on form submit
    document.querySelectorAll('form').forEach(function(f){
        f.addEventListener('submit', function(){
            if (location.hash) f.action = f.action.split('#')[0] + location.hash;
        });
    });
    // Theme toggle
    (function(){
        var btn = document.getElementById('theme-toggle');
        if (!btn) return;
        var sunSvg = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>';
        var moonSvg = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>';
        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            var body = document.body;
            var current = body.getAttribute('data-theme') || 'dark';
            var next = current === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', next);
            btn.innerHTML = next === 'light' ? moonSvg : sunSvg;
            btn.title = next === 'light' ? 'Switch to dark' : 'Switch to light';
            var icon = document.querySelector('.sidebar-icon');
            var full = document.querySelector('.sidebar-logo-full');
            if (icon) icon.src = next === 'light' ? '/static/images/logo-v-light.png' : '/static/images/logo-v.png';
            if (full) full.src = next === 'light' ? '/static/images/logo-transparent-light.png' : '/static/images/logo-transparent.png';
            document.querySelectorAll('.theme-logo').forEach(function(el) {
                el.src = next === 'light' ? '/static/images/logo-v-light.png' : '/static/images/logo-v.png';
            });
            fetch('/{{ admin_slug }}/api/theme', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({theme: next})
            });
        });
    })();
    {% if flash_msg is defined and flash_msg %}
    (function(){
        var el = document.createElement('div');
        el.className = 'alert alert-{{ flash_kind | default(value="info") }} alert-flash';
        el.innerHTML = '<span>{{ flash_msg }}</span><button type="button" class="alert-close" onclick="this.parentElement.remove()">&times;</button>';
        var header = document.querySelector('.page-header');
        if (header) header.insertAdjacentElement('afterend', el);
        else { var main = document.querySelector('.content-area'); if (main) main.prepend(el); }
        setTimeout(function(){ if (el.parentElement) { el.style.transition='opacity 0.4s'; el.style.opacity='0'; setTimeout(function(){ el.remove(); },400); } }, 8000);
    })();
    {% endif %}
    </script>
</body>
</html>
